<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Japan Tourism Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    #container {
      display: flex;
      height: 100vh;
      flex-direction: row;
      align-items: stretch;
    }

    #side-panel {
      flex-basis: 400px;
      background: white;
      overflow-y: auto;
      padding: 16px;
      box-shadow: -3px 0 10px rgba(0, 0, 0, 0.2);
      z-index: 1;
    }

    #map {
      flex-grow: 1;
    }

    h2 {
      text-align: center;
    }

    button {
      display: block;
      margin: 0 auto 10px auto;
      padding: 8px 16px;
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      border: 1px solid #ddd;
    }

    th, td {
      text-align: left;
      padding: 12px;
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    @media (max-width: 1024px) {
      #side-panel {
        display: none;
      }
    }
  </style>
</head>

<body>
  <main id="container">
    <div id="side-panel">
      <h2>Japan Tourist Spots</h2>
      <button id="sortAlphaButton">Sort Alphabetically</button>
      <button id="toggleAirportsButton">Hide Airports</button>
      <table id="info-table">
        <tr>
          <th>Name</th>
          <th>Type</th>
        </tr>
      </table>
    </div>

    <div id="map"></div>
  </main>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoia3JpZGFuZyIsImEiOiJjbWhib3YwM3cxYmM0Mmxwdm00MmpubjdnIn0.A_2GT3PB5OEdbL9HLwlubQ';

    let map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/navigation-day-v1',
      zoom: 5.5,
      center: [138, 38]
    });

    let airportsVisible = true;

    async function geojsonFetch() {
      let response, touristSpots, airports;

      response = await fetch('assets/japan_tourist_spots.geojson');
      touristSpots = await response.json();

      response = await fetch('assets/japan_airports.geojson');
      airports = await response.json();

      map.on('load', function () {
        map.addSource('touristSpots', { type: 'geojson', data: touristSpots });
        map.addLayer({
          id: 'touristSpots-layer',
          type: 'circle',
          source: 'touristSpots',
          paint: {
            'circle-radius': 7,
            'circle-color': '#ff6347',
            'circle-stroke-color': 'white',
            'circle-stroke-width': 2
          }
        });

        map.addSource('airports', { type: 'geojson', data: airports });
        map.addLayer({
          id: 'airports-layer',
          type: 'circle',
          source: 'airports',
          paint: {
            'circle-radius': 6,
            'circle-color': '#1e90ff',
            'circle-stroke-color': 'white',
            'circle-stroke-width': 2
          }
        });
      });

      table = document.getElementsByTagName("table")[0];
      let row, cell1, cell2;

      for (let i = 0; i < touristSpots.features.length; i++) {
          row = table.insertRow(-1);
          cell1 = row.insertCell(0);
          cell2 = row.insertCell(1);

          cell1.innerHTML = touristSpots.features[i].properties.name;
          cell2.innerHTML = touristSpots.features[i].properties.type;
      }

    }

  let btn = document.getElementsByTagName("button")[0];
  btn.addEventListener('click', sortTable);

  function sortTable(e) {
    let table, rows, switching, i, x, y, shouldSwitch;
    table = document.getElementsByTagName("table")[0];
    switching = true;

    while (switching) {
      switching = false;
      rows = table.rows;
      for (i = 1; i < (rows.length - 1); i++) {
        shouldSwitch = false;
        x = rows[i].getElementsByTagName("td")[0].innerHTML.toLowerCase();
        y = rows[i + 1].getElementsByTagName("td")[0].innerHTML.toLowerCase();

          if (x > y) {
          shouldSwitch = true;
          break;
        }
       }
      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
      }
    }
  }

    document.getElementById("toggleAirportsButton").addEventListener("click", () => {
      airportsVisible = !airportsVisible;
      map.setLayoutProperty('airports-layer', 'visibility', airportsVisible ? 'visible' : 'none');
      document.getElementById("toggleAirportsButton").innerText = airportsVisible ? "Hide Airports" : "Show Airports";
    });

    geojsonFetch();
  </script>
</body>
</html>

  